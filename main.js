(()=>{"use strict";var e={},t=(document.querySelectorAll(".popup__button-close"),document.querySelector("#card-template").content),n=document.querySelector(".elements"),o=document.querySelector(".profile__title-name"),r=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__button-change"),i=document.querySelector(".profile__subtitle"),u=document.querySelector(".profile__button-edit"),a=document.querySelector(".popup_type_change"),l=a.querySelector(".form"),s=a.querySelector(".form__input_type_link-avatar"),d=(document.querySelector("#change-button"),document.querySelector(".popup_type_edit")),m=d.querySelector(".form"),_=d.querySelector(".form__input_type_title-name"),f=d.querySelector(".form__input_type_occupation"),p=document.querySelector("#add-button"),v=document.querySelector(".profile__button-add"),y=document.querySelector(".popup_type_add"),h=y.querySelector(".form"),S=y.querySelector(".form__input_type_title-card"),b=y.querySelector(".form__input_type_link-card"),q=document.querySelector(".popup_type_image"),L=q.querySelector(".popup__image"),k=q.querySelector(".popup__image-subtitle");function E(e){"Escape"===e.key&&C(document.querySelector(".popup_opened")),(e.target.classList.contains("popup")||e.target.classList.contains("popup__button-close"))&&C(e.currentTarget)}function g(e){e.classList.add("popup_opened"),document.addEventListener("keydown",E),e.addEventListener("mousedown",E)}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",E),e.removeEventListener("mousedown",E)}document.querySelectorAll(".popup");var x={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15/",headers:{authorization:"9e001846-a8d2-4f41-9753-96fcc2007821","Content-Type":"application/json"}};function A(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function T(e,t,n){return fetch("".concat(e.baseUrl).concat(n),{method:t,headers:e.headers})}function w(e,t,n,o){return fetch("".concat(e.baseUrl).concat(n),{method:t,headers:e.headers,body:JSON.stringify(o)})}function D(n){var o=t.querySelector(".element").cloneNode(!0),r=o.querySelector(".element__image"),c=o.querySelector(".element__caption-text"),i=o.querySelector(".element__button-delete"),u=o.querySelector(".element__count-like"),a=o.querySelector(".element__button-like");return r.setAttribute("src",n.link),r.setAttribute("alt",n.name),c.textContent=n.name,u.textContent=n.likes.length,n.likes.forEach((function(t){t._id===e.id&&a.classList.add("element__button-like_active")})),e.id===n.owner._id&&i.classList.add("element__button-delete_active"),i.addEventListener("click",(function(){var e;(e=n._id,T(x,"DELETE","cards/".concat(e)).then(A)).then((function(){i.closest(".element").remove()})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(e){var t,o,r;t=e.target,o=u,r=n._id,t.classList.contains("element__button-like_active")?function(e){return T(x,"DELETE","cards/likes/".concat(e)).then(A)}(r).then((function(e){o.textContent=e.likes.length,t.classList.remove("element__button-like_active")})).catch((function(e){console.log(e)})):function(e){return T(x,"PUT","cards/likes/".concat(e)).then(A)}(r).then((function(e){o.textContent=e.likes.length,t.classList.add("element__button-like_active")})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){g(q),L.src=r.src,L.alt=r.alt,k.textContent=c.textContent})),o}function P(e,t){var n=D(e);t.prepend(n)}function B(e,t){e.textContent=t?"Сохранение...":"Сохранить"}var U,j,M,G,H,N,O,V=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))};c.addEventListener("click",(function(){g(a)})),u.addEventListener("click",(function(){g(d),_.value=o.textContent,f.value=i.textContent})),v.addEventListener("click",(function(){g(y)})),m.addEventListener("submit",(function(e){e.preventDefault(),B(e.submitter,!0);var t={};t.name=_.value,t.about=f.value,function(e){return w(x,"PATCH","users/me",e).then(A)}(t).then((function(e){o.textContent=e.name,i.textContent=e.about,C(d)})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,!1)}))})),h.addEventListener("submit",(function(e){var t,o;e.preventDefault(),B(e.submitter,!0),(o={},o.name=S.value,o.link=b.value,t=o,w(x,"POST","cards",t).then(A)).then((function(t){P({name:t.name,link:t.link,owner:t.owner,likes:t.likes,_id:t._id},n),e.target.reset(),p.classList.add("form__button-submit_inactive"),p.disabled=!0,C(y)})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,!1)}))})),l.addEventListener("submit",(function(e){e.preventDefault(),B(e.submitter,!0);var t={};t.avatar=s.value,function(e){return w(x,"PATCH","users/me/avatar",e).then(A)}(t).then((function(t){r.src=t.avatar,e.target.reset(),C(a)})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,!1)}))})),j=(U={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}).formSelector,M=U.inputSelector,G=U.submitButtonSelector,H=U.inactiveButtonClass,N=U.inputErrorClass,O=U.errorClass,Array.from(document.querySelectorAll(j)).forEach((function(e){!function(e,t,n,o,r,c){var i=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);V(i,u,o),i.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),V(i,u,o)}))}))}(e,M,G,H,N,O)})),T(x,"GET","users/me").then(A).then((function(t){e.id=t._id,function(e,t,n){o.textContent=e,i.textContent=t,r.src=n}(t.name,t.about,t.avatar)})).catch((function(e){console.log(e)})),T(x,"GET","cards").then(A).then((function(e){e.reverse().forEach((function(e){P(e,n)}))})).catch((function(e){console.log(e)}))})();