(()=>{"use strict";var e={},t=(document.querySelectorAll(".popup__button-close"),document.querySelector("#card-template").content),n=document.querySelector(".elements"),o=document.querySelector(".profile__title-name"),r=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__button-change"),i=document.querySelector(".profile__subtitle"),u=document.querySelector(".profile__button-edit"),a=document.querySelector(".popup_type_change"),l=a.querySelector(".form"),s=a.querySelector(".form__input_type_link-avatar"),d=document.querySelector("#change-button"),m=document.querySelector(".popup_type_edit"),f=m.querySelector(".form"),_=m.querySelector(".form__input_type_title-name"),p=m.querySelector(".form__input_type_occupation"),y=document.querySelector("#add-button"),v=document.querySelector(".profile__button-add"),b=document.querySelector(".popup_type_add"),h=b.querySelector(".form"),S=b.querySelector(".form__input_type_title-card"),q=b.querySelector(".form__input_type_link-card"),L=document.querySelector(".popup_type_image"),g=L.querySelector(".popup__image"),k=L.querySelector(".popup__image-subtitle");function E(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__button-close"))&&A(e.currentTarget)}function C(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))}function x(e){e.classList.add("popup_opened"),document.addEventListener("keydown",C),e.addEventListener("mousedown",E)}function A(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",C),e.removeEventListener("mousedown",E)}document.querySelectorAll(".popup");var w={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15/",headers:{authorization:"9e001846-a8d2-4f41-9753-96fcc2007821","Content-Type":"application/json"}};function T(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function j(e,t,n){return fetch("".concat(e.baseUrl).concat(n),{method:t,headers:e.headers})}function P(e,t,n,o){return fetch("".concat(e.baseUrl).concat(n),{method:t,headers:e.headers,body:JSON.stringify(o)})}function D(n){var o=t.querySelector(".element").cloneNode(!0),r=o.querySelector(".element__image"),c=o.querySelector(".element__caption-text"),i=o.querySelector(".element__button-delete"),u=o.querySelector(".element__count-like"),a=o.querySelector(".element__button-like");return r.setAttribute("src",n.link),r.setAttribute("alt",n.name),c.textContent=n.name,u.textContent=n.likes.length,n.likes.forEach((function(t){t._id===e.id&&a.classList.add("element__button-like_active")})),e.id===n.owner._id&&i.classList.add("element__button-delete_active"),i.addEventListener("click",(function(){var e;(e=n._id,j(w,"DELETE","cards/".concat(e)).then(T)).then((function(){i.closest(".element").remove()})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(e){var t,o,r;t=e.target,o=u,r=n._id,t.classList.contains("element__button-like_active")?function(e){return j(w,"DELETE","cards/likes/".concat(e)).then(T)}(r).then((function(e){o.textContent=e.likes.length,t.classList.remove("element__button-like_active")})).catch((function(e){console.log(e)})):function(e){return j(w,"PUT","cards/likes/".concat(e)).then(T)}(r).then((function(e){o.textContent=e.likes.length,t.classList.add("element__button-like_active")})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){x(L),g.src=r.src,g.alt=r.alt,k.textContent=c.textContent})),o}function U(e,t){var n=D(e);t.prepend(n)}function B(e,t){e.textContent=t?"Сохранение...":"Сохранить"}var M,O,I,G,H,N,V,z=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))};function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}c.addEventListener("click",(function(){x(a)})),u.addEventListener("click",(function(){x(m),_.value=o.textContent,p.value=i.textContent})),v.addEventListener("click",(function(){x(b)})),f.addEventListener("submit",(function(e){e.preventDefault(),B(e.submitter,!0);var t={};t.name=_.value,t.about=p.value,function(e){return P(w,"PATCH","users/me",e).then(T)}(t).then((function(e){o.textContent=e.name,i.textContent=e.about,A(m)})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,!1)}))})),h.addEventListener("submit",(function(e){var t,o;e.preventDefault(),B(e.submitter,!0),(o={},o.name=S.value,o.link=q.value,t=o,P(w,"POST","cards",t).then(T)).then((function(t){U({name:t.name,link:t.link,owner:t.owner,likes:t.likes,_id:t._id},n),e.target.reset(),y.classList.add("form__button-submit_inactive"),y.disabled=!0,A(b)})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,!1)}))})),l.addEventListener("submit",(function(e){e.preventDefault(),B(e.submitter,!0);var t={};t.avatar=s.value,function(e){return P(w,"PATCH","users/me/avatar",e).then(T)}(t).then((function(t){r.src=t.avatar,e.target.reset(),d.classList.add("form__button-submit_inactive"),d.disabled=!0,A(a)})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,!1)}))})),O=(M={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}).formSelector,I=M.inputSelector,G=M.submitButtonSelector,H=M.inactiveButtonClass,N=M.inputErrorClass,V=M.errorClass,Array.from(document.querySelectorAll(O)).forEach((function(e){!function(e,t,n,o,r,c){var i=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);z(i,u,o),i.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),z(i,u,o)}))}))}(e,I,G,H,N,V)})),Promise.all([j(w,"GET","users/me").then(T),j(w,"GET","cards").then(T)]).then((function(t){var c,u,a=(u=2,function(e){if(Array.isArray(e))return e}(c=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw r}}return c}}(c,u)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(c,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=a[0],s=a[1];e.id=l._id,function(e,t,n){o.textContent=e,i.textContent=t,r.src=n}(l.name,l.about,l.avatar),s.reverse().forEach((function(e){U(e,n)}))})).catch((function(e){console.log(e)}))})();